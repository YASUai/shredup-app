<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>SHRED UP - Tuner V3</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: 'Conthrax';
      src: url('/static/metronome/fonts/conthrax-sb.woff2') format('woff2'),
           url('/static/metronome/fonts/conthrax-sb.woff') format('woff');
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      background: #141414;
      padding: 0;
      color: #666;
      margin: 0;
      overflow: hidden;
      height: 100vh;
    }

    .container {
      max-width: 100%;
      width: 100%;
      height: 100%;
      padding: 15px;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
      display: none;
    }

    .sample {
      background: #1a1a1a;
      border-radius: 16px;
      padding: 20px;
      position: relative;
      border: 1px solid #222;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .sample-label {
      position: absolute;
      top: -12px;
      left: 40px;
      background: #1a1a1a;
      color: #666;
      padding: 4px 16px;
      font-size: 10px;
      font-weight: 400;
      letter-spacing: 2px;
      text-transform: uppercase;
      border: 1px solid #333;
      display: none;
    }

    /* ON/OFF Toggle Button - Neumorphic - BOTTOM RIGHT */
    .toggle-container {
      position: absolute;
      bottom: 20px;
      right: 20px;
      z-index: 100;
    }
    
    .toggle-btn {
      width: 80px;
      height: 36px;
      background: #1a1a1a;
      border-radius: 18px;
      border: 1px solid #222;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 
        inset 2px 2px 5px rgba(0,0,0,0.5),
        inset -2px -2px 5px rgba(255,255,255,0.02);
    }
    
    .toggle-btn.active {
      background: #1e1e1e;
      box-shadow: 
        inset 2px 2px 5px rgba(0,0,0,0.3),
        inset -2px -2px 5px rgba(255,255,255,0.03);
    }
    
    .toggle-knob {
      width: 28px;
      height: 28px;
      background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
      border-radius: 50%;
      position: absolute;
      top: 3px;
      left: 4px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        2px 2px 4px rgba(0,0,0,0.4),
        -1px -1px 2px rgba(255,255,255,0.03);
    }
    
    .toggle-btn.active .toggle-knob {
      left: 48px;
      background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
    }
    
    .toggle-label {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 9px;
      font-weight: 500;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      text-transform: uppercase;
    }
    
    .toggle-label.off {
      right: 8px;
      color: #555;
    }
    
    .toggle-label.on {
      left: 8px;
      color: #888;
      opacity: 0;
    }
    
    .toggle-btn.active .toggle-label.off {
      opacity: 0;
    }
    
    .toggle-btn.active .toggle-label.on {
      opacity: 1;
    }

    .bars-row {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-shrink: 0;
    }
    .bar-item {
      text-align: center;
    }
    .bar {
      width: 20px;
      background: linear-gradient(180deg, #3a3a3a, #2a2a2a);
      margin: 0 auto 6px;
      transition: height 0.3s ease;
    }
    .bar-label {
      font-size: 8px;
      color: #555;
    }

    .hex-area {
      position: relative;
      height: 220px;
      background: #1a1a1a;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 20px;
      flex-shrink: 0;
    }
    .hex {
      width: 50px;
      height: 58px;
      position: relative;
      transition: all 0.3s ease;
    }
    .hex-shape {
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #555;
      transition: all 0.3s ease;
    }
    .hex.active .hex-shape {
      background: #1e1e1e;
      border-color: #3a3a3a;
      color: #888;
    }

    .v2-top {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      pointer-events: none;
    }
    .v2-note {
      font-size: 72px;
      font-weight: 600;
      font-family: 'Conthrax', 'Orbitron', sans-serif;
      color: #888;
      letter-spacing: 4px;
      transition: all 0.3s ease;
      line-height: 1;
    }
    .v2-bottom {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      pointer-events: none;
    }
    .v2-freq {
      font-size: 14px;
      color: #555;
      letter-spacing: 3px;
      transition: all 0.3s ease;
    }

    /* Cents line visualization */
    .cents-line {
      height: 70px;
      background: #1a1a1a;
      border-radius: 8px;
      position: relative;
      margin-bottom: 15px;
      border: 1px solid #222;
      overflow: hidden;
      flex-shrink: 0;
    }
    .cents-line-graph {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100%;
      pointer-events: none;
    }
    .cents-line-track {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: #2a2a2a;
    }
    .cents-info {
      position: absolute;
      top: 6px;
      left: 12px;
      font-size: 10px;
      color: #555;
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .cents-value {
      color: #888;
      font-weight: 400;
    }

    /* Tuning meter */
    .tuning-meter {
      height: 50px;
      background: #1a1a1a;
      border-radius: 8px;
      position: relative;
      margin-bottom: 15px;
      border: 1px solid #222;
      overflow: hidden;
      flex-shrink: 0;
    }
    .meter-track {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      height: 1px;
      background: #2a2a2a;
    }
    .meter-center-mark {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: 24px;
      background: #3a3a3a;
    }
    .meter-marks {
      position: absolute;
      top: 50%;
      left: 0;
      right: 0;
      transform: translateY(-50%);
      display: flex;
      justify-content: space-between;
      padding: 0 40px;
    }
    .meter-mark {
      width: 1px;
      height: 12px;
      background: #2a2a2a;
    }
    .meter-needle {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 2px;
      height: 32px;
      background: linear-gradient(180deg, transparent 0%, #888 30%, #888 70%, transparent 100%);
      transition: left 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 10;
    }
    .meter-needle::before {
      content: '';
      position: absolute;
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 4px solid transparent;
      border-right: 4px solid transparent;
      border-top: 6px solid #888;
    }
    .meter-labels {
      position: absolute;
      bottom: 6px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      padding: 0 35px;
      font-size: 8px;
      color: #555;
      letter-spacing: 1px;
    }

    .controls {
      display: none;
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="sample">
      <!-- ON/OFF Toggle -->
      <div class="toggle-container">
        <div class="toggle-btn" id="power-toggle">
          <div class="toggle-knob"></div>
          <span class="toggle-label on">ON</span>
          <span class="toggle-label off">OFF</span>
        </div>
      </div>

      <div class="bars-row">
        <div class="bar-item">
          <div class="bar" id="bar-0" style="height: 60px;"></div>
          <div class="bar-label">A1</div>
        </div>
        <div class="bar-item">
          <div class="bar" id="bar-1" style="height: 75px;"></div>
          <div class="bar-label">D2</div>
        </div>
        <div class="bar-item">
          <div class="bar" id="bar-2" style="height: 90px;"></div>
          <div class="bar-label">G2</div>
        </div>
        <div class="bar-item">
          <div class="bar" id="bar-3" style="height: 78px;"></div>
          <div class="bar-label">C3</div>
        </div>
        <div class="bar-item">
          <div class="bar" id="bar-4" style="height: 68px;"></div>
          <div class="bar-label">F3</div>
        </div>
        <div class="bar-item">
          <div class="bar" id="bar-5" style="height: 58px;"></div>
          <div class="bar-label">A3</div>
        </div>
        <div class="bar-item">
          <div class="bar" id="bar-6" style="height: 48px;"></div>
          <div class="bar-label">D4</div>
        </div>
      </div>

      <div class="hex-area">
        <div class="hex" id="hex-0">
          <div class="hex-shape">A1</div>
        </div>
        <div class="hex" id="hex-1">
          <div class="hex-shape">D2</div>
        </div>
        <div class="hex active" id="hex-2">
          <div class="hex-shape">G2</div>
        </div>
        <div class="hex" id="hex-3">
          <div class="hex-shape">C3</div>
        </div>
        <div class="hex" id="hex-4">
          <div class="hex-shape">F3</div>
        </div>
        <div class="hex" id="hex-5">
          <div class="hex-shape">A3</div>
        </div>
        <div class="hex" id="hex-6">
          <div class="hex-shape">D4</div>
        </div>

        <div class="v2-top">
          <div class="v2-note" id="note-display">A1</div>
        </div>
        <div class="v2-bottom">
          <div class="v2-freq" id="freq-display">55.00 HZ</div>
        </div>
      </div>

      <!-- Cents line visualization -->
      <div class="cents-line">
        <canvas id="cents-canvas" class="cents-line-graph" width="720" height="70"></canvas>
        <div class="cents-line-track"></div>
        <div class="cents-info">
          STRING <span class="cents-value" id="string-info">1/7</span> Â· 
          <span class="cents-value" id="cents-info">-4</span> CENTS
        </div>
      </div>

      <!-- Tuning meter -->
      <div class="tuning-meter">
        <div class="meter-track"></div>
        <div class="meter-center-mark"></div>
        <div class="meter-marks">
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
          <div class="meter-mark"></div>
        </div>
        <div class="meter-needle" id="meter-needle"></div>
        <div class="meter-labels">
          <span>-50</span>
          <span>-25</span>
          <span style="color: #888;">0</span>
          <span>+25</span>
          <span>+50</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 7-string guitar tuning (A1â†’D4)
    const NOTES = [
      { name: 'A1', freq: 55.0, string: 1 },
      { name: 'D2', freq: 73.42, string: 2 },
      { name: 'G2', freq: 98.0, string: 3 },
      { name: 'C3', freq: 130.81, string: 4 },
      { name: 'F3', freq: 174.61, string: 5 },
      { name: 'A3', freq: 220.0, string: 6 },
      { name: 'D4', freq: 293.66, string: 7 }
    ];
    
    let currentNoteIndex = 0; // Start with A1
    let tunerRunning = false;
    let animationFrame = null;
    let currentCents = -4;
    
    // DOM elements
    const noteEl = document.getElementById('note-display');
    const freqEl = document.getElementById('freq-display');
    const stringInfoEl = document.getElementById('string-info');
    const centsInfoEl = document.getElementById('cents-info');
    const needleEl = document.getElementById('meter-needle');
    const powerToggle = document.getElementById('power-toggle');
    const bars = [];
    const hexes = [];
    
    // Cents line canvas
    const centsCanvas = document.getElementById('cents-canvas');
    const centsCtx = centsCanvas.getContext('2d');
    const centsHistory = [];
    const maxCentsHistory = 120;
    
    for (let i = 0; i < 7; i++) {
      bars.push(document.getElementById(`bar-${i}`));
      hexes.push(document.getElementById(`hex-${i}`));
    }
    
    // Generate oscillating cents value
    function generateCents() {
      const base = Math.sin(Date.now() / 1000) * 10; // -10 to +10
      const noise = (Math.random() - 0.5) * 4; // Â±2 noise
      return Math.round(base + noise);
    }
    
    // Update bars heights (subtle animation)
    function updateBars() {
      bars.forEach((bar, i) => {
        const baseHeight = 48 + i * 6; // Base heights: 48, 54, 60, 66, 72, 78, 84
        const activeBoost = (i === currentNoteIndex) ? 15 : 0;
        const oscillation = Math.sin(Date.now() / 800 + i * 0.5) * 8;
        const height = baseHeight + activeBoost + oscillation;
        bar.style.height = `${Math.max(40, Math.min(100, height))}px`;
      });
    }
    
    // Update active hexagon
    function updateHexagons() {
      hexes.forEach((hex, i) => {
        if (i === currentNoteIndex) {
          hex.classList.add('active');
        } else {
          hex.classList.remove('active');
        }
      });
    }
    
    // Draw cents line graph
    function drawCentsLine() {
      const width = centsCanvas.width;
      const height = centsCanvas.height;
      
      // Clear canvas
      centsCtx.clearRect(0, 0, width, height);
      
      // Draw zero line (horizontal center)
      centsCtx.strokeStyle = '#2a2a2a';
      centsCtx.lineWidth = 1;
      centsCtx.beginPath();
      centsCtx.moveTo(0, height / 2);
      centsCtx.lineTo(width, height / 2);
      centsCtx.stroke();
      
      // Draw cents history line
      if (centsHistory.length > 1) {
        centsCtx.strokeStyle = '#666';
        centsCtx.lineWidth = 2;
        centsCtx.beginPath();
        
        const step = width / maxCentsHistory;
        
        centsHistory.forEach((cents, i) => {
          const x = i * step;
          // Map cents (-50 to +50) to y position
          const y = height / 2 - (cents / 50) * (height / 2 - 10);
          
          if (i === 0) {
            centsCtx.moveTo(x, y);
          } else {
            centsCtx.lineTo(x, y);
          }
        });
        
        centsCtx.stroke();
      }
    }
    
    // Update cents history
    function updateCentsHistory() {
      centsHistory.push(currentCents);
      if (centsHistory.length > maxCentsHistory) {
        centsHistory.shift();
      }
      drawCentsLine();
    }
    
    // Update needle position
    function updateNeedle() {
      // Map cents (-50 to +50) to position (0% to 100%)
      const normalizedCents = (currentCents + 50) / 100; // 0 to 1
      const position = normalizedCents * 100;
      needleEl.style.left = `${position}%`;
    }
    
    // Update display
    function updateDisplay() {
      const note = NOTES[currentNoteIndex];
      currentCents = generateCents();
      
      noteEl.textContent = note.name;
      freqEl.textContent = `${note.freq.toFixed(2)} HZ`;
      
      const centsSign = currentCents >= 0 ? '+' : '';
      stringInfoEl.textContent = `${note.string}/7`;
      centsInfoEl.textContent = `${centsSign}${currentCents}`;
      
      updateHexagons();
      updateNeedle();
      updateCentsHistory();
    }
    
    // Animation loop
    function animate() {
      if (!tunerRunning) return;
      
      updateBars();
      updateDisplay();
      
      animationFrame = requestAnimationFrame(animate);
    }
    
    // Change note every 3 seconds
    function cycleNotes() {
      if (!tunerRunning) return;
      
      currentNoteIndex = (currentNoteIndex + 1) % NOTES.length;
      
      setTimeout(cycleNotes, 3000);
    }
    
    // Toggle power
    powerToggle.addEventListener('click', () => {
      tunerRunning = !tunerRunning;
      
      if (tunerRunning) {
        powerToggle.classList.add('active');
        animate();
        cycleNotes();
      } else {
        powerToggle.classList.remove('active');
        
        if (animationFrame) {
          cancelAnimationFrame(animationFrame);
          animationFrame = null;
        }
      }
    });
    
    // Initialize
    currentCents = -4;
    currentNoteIndex = 0;
    stringInfoEl.textContent = '1/7';
    centsInfoEl.textContent = '-4';
    updateHexagons();
    updateNeedle();
    
    // Resize canvas to fit container
    function resizeCentsCanvas() {
      const rect = centsCanvas.parentElement.getBoundingClientRect();
      centsCanvas.width = rect.width;
      centsCanvas.height = 70;
      drawCentsLine();
    }
    
    resizeCentsCanvas();
    window.addEventListener('resize', resizeCentsCanvas);
    
    console.log('ðŸŽ¸ SHRED UP Tuner V3 loaded - ' + new Date().toISOString());
  </script>
</body>
</html>
